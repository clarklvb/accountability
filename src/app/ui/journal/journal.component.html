<div *ngIf="(authService.user | async) as user">
  <h1>New Journal Entry</h1>
  <div class="column is-12">
    <form [formGroup]="addJournalEntryForm" (ngSubmit)="addJournalEntry()">
      <table class="table">
        <thead>
          <tr>
            <th>Information</th>
            <th>Accounts</th>
            <th>Debit</th>
            <th>Credit</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="rows info-container">
              <span id="current-date">{{ currentDate | date }}</span>
              <input
                class="input"
                type="text"
                name="userFullName"
                formControlName="userFullName"
                disabled
                [(ngModel)]="user.displayName"
              />
            </td>
            <td class="rows">
              <select
                class="input"
                formControlName="debitAccount"
                name="debitAccount"
                required
              >
                <option value="" disabled selected>Select an account</option>
                <option
                  *ngFor="let account of (accountList | async)"
                  [ngValue]="account"
                  >{{ account.name }}</option
                >
              </select>
            </td>
            <td class="rows">
              <input
                class="input"
                type="number"
                name="debitAmount"
                formControlName="debitAmount"
                placeholder="Enter amount"
              />
            </td>
            <td class="rows"></td>
          </tr>
          <tr>
            <td class="rows"></td>
            <td class="rows">
              <select
                class="input"
                formControlName="creditAccount"
                name="creditAccount"
                required
              >
                <option value="" disabled selected>Select an account</option>
                <option
                  *ngFor="let account of (accountList | async)"
                  [ngValue]="account"
                  >{{ account.name }}</option
                >
              </select>
            </td>
            <td class="rows">&nbsp;</td>
            <td class="rows">
              <input
                class="input"
                type="number"
                name="creditAmount"
                formControlName="creditAmount"
                placeholder="Enter amount"
              />
            </td>
          </tr>
          <tr>
            <td class="rows">
              <input
                class="input"
                type="text"
                name="desc"
                formControlName="description"
                placeholder="Description for entry"
              />
              <file-upload></file-upload>
            </td>
            <td class="rows"></td>
            <td class="rows"></td>
            <td class="actions-container rows">
              <button
                type="submit"
                class="button is-link"
                [disabled]="!addJournalEntryForm.valid"
              >
                Submit
              </button>
              <span (click)="buildForm()" class="button is-link is-danger"
                >Reset</span
              >
            </td>
          </tr>
          <tr></tr>
        </tbody>
      </table>
    </form>
  </div>
  <div class="column is-12">
    <h1 class="is-pulled-left">Journal</h1>
    <div class="buttons has-addons is-right">
      <span
        (click)="setApprovalFlag('approved')"
        [ngClass]="{ 'is-selected is-success has-white-text': showApproved }"
        class="button"
        >Approved</span
      >
      <span
        (click)="setApprovalFlag('pending')"
        [ngClass]="{ 'is-selected is-warning': showPending }"
        class="button"
        >Pending</span
      >
      <span
        (click)="setApprovalFlag('rejected')"
        [ngClass]="{ 'is-selected is-danger has-white-text': showRejected }"
        class="button"
        >Rejected</span
      >
    </div>
  </div>
  <div class="column is-12">
    <input
      class="input column is-4"
      type="text"
      [(ngModel)]="searchText"
      placeholder="Search"
    />
    <table class="table transaction-table">
      <thead>
        <tr>
          <th>Date</th>
          <th>User</th>
          <th>Description</th>
          <th>Accounts</th>
          <th class="has-text-right">Debit</th>
          <th class="has-text-right">Credit</th>
          <th *ngIf="user.role === 'Manager'">Options</th>
        </tr>
      </thead>
      <tbody
        *ngFor="
          let entry of (transactionsList
            | async
            | filter
              : {
                  userFullname: searchText,
                  description: searchText,
                  accountName: searchText
                })
        "
      >
        <tr>
          <td class="rows date-row">
            {{ entry.createdAt | date }}
            <div *ngIf="user.role === 'Accountant'">
              <div *ngIf="!entry.pending">
                <p class="has-text-success" *ngIf="entry.approved">Approved</p>
                <p class="has-text-danger" *ngIf="!entry.approved">Rejected</p>
              </div>
              <p class="has-text-warning" *ngIf="entry.pending">Pending</p>
            </div>
          </td>
          <td class="rows">
            <div *ngIf="entry.userFullName">{{ entry.userFullName }}</div>
          </td>
          <td class="rows">{{ entry.description }}</td>
          <td class="rows">
            <span *ngFor="let debitEntry of entry.debitEntries">{{
              debitEntry.accountName
            }}</span>
          </td>
          <td class="rows has-text-right">
            <span *ngFor="let debitEntry of entry.debitEntries">{{
              debitEntry.amount | currency
            }}</span>
          </td>
          <td class="rows"></td>
          <td
            class="rows date-row"
            *ngIf="user.role === 'Manager' && entry.pending"
          >
            <a
              [ngClass]="{ 'is-success has-text-white': entry.approved }"
              class="approve-link button"
              (click)="toggleApproval(entry.id, true)"
              >Approve</a
            >
            <a
              [ngClass]="{
                'is-danger has-text-white': !entry.approved && !entry.pending
              }"
              class="approve-link button"
              (click)="toggleApproval(entry.id, false)"
              >Reject</a
            >
          </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td></td>
          <td id="credit" class="rows credit-account-name">
            <span *ngFor="let creditEntry of entry.creditEntries">{{
              creditEntry.accountName
            }}</span>
          </td>
          <td></td>
          <td class="rows has-text-right">
            <span *ngFor="let creditEntry of entry.creditEntries">{{
              creditEntry.amount | currency
            }}</span>
          </td>
          <td *ngIf="user.role === 'Manager'"></td>
        </tr>
      </tbody>
    </table>
  </div>
  <!--
    -








      <table mat-table [dataSource]="transactionsList" class="mat-elevation-z8">










      <ng-container matColumnDef="createdAt">









    	<th mat-header-cell *matHeaderCellDef> Date </th>









    	<td mat-cell *matCellDef="let element"> {{entry.createdAt | date}} </td>









      </ng-container>










      









      <ng-container matColumnDef="description">









    	<th mat-header-cell *matHeaderCellDef> Description </th>









    	<td mat-cell *matCellDef="let element"> {{entry.description}} </td>









      </ng-container>










      









      <ng-container matColumnDef="description">









    	<th mat-header-cell *matHeaderCellDef> Accounts </th>









    	<td mat-cell *matCellDef="let element"> {{entry.description}} </td>









      </ng-container>










     









      <ng-container matColumnDef="description">









    	<th mat-header-cell *matHeaderCellDef> Debit </th>









    	<td mat-cell *matCellDef="let element"> {{entry.description}} </td>









      </ng-container>









      









      <ng-container matColumnDef="description">









    	<th mat-header-cell *matHeaderCellDef> Credit </th>









    	<td mat-cell *matCellDef="let element"> {{entry.description}} </td>









      </ng-container>










      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>









      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>









    </table>
  -->
</div>
